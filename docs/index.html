<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>Home - Documentation</title>
    <link rel="icon" type="image/png" href="favicon.png"/>

    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Axis.html">Axis</a><ul class='methods'><li data-type='method'><a href="Axis.html#.AttemptValidateParameter">AttemptValidateParameter</a></li><li data-type='method'><a href="Axis.html#.AttemptValidateProgression">AttemptValidateProgression</a></li><li data-type='method'><a href="Axis.html#.LookupTypeName">LookupTypeName</a></li><li data-type='method'><a href="Axis.html#Advance">Advance</a></li><li data-type='method'><a href="Axis.html#CalculatePosition">CalculatePosition</a></li><li data-type='method'><a href="Axis.html#CheckComplete">CheckComplete</a></li><li data-type='method'><a href="Axis.html#Reset">Reset</a></li><li data-type='method'><a href="Axis.html#WriteReport">WriteReport</a></li></ul></li><li><a href="AxisSet.html">AxisSet</a><ul class='methods'><li data-type='method'><a href="AxisSet.html#AdvanceAxis">AdvanceAxis</a></li><li data-type='method'><a href="AxisSet.html#CheckAxisComplete">CheckAxisComplete</a></li><li data-type='method'><a href="AxisSet.html#CreateParams">CreateParams</a></li><li data-type='method'><a href="AxisSet.html#GetTotalAxes">GetTotalAxes</a></li><li data-type='method'><a href="AxisSet.html#ResetAxis">ResetAxis</a></li><li data-type='method'><a href="AxisSet.html#Walk">Walk</a></li><li data-type='method'><a href="AxisSet.html#WriteAxisReport">WriteAxisReport</a></li></ul></li><li><a href="AxisSetTraverser.html">AxisSetTraverser</a><ul class='methods'><li data-type='method'><a href="AxisSetTraverser.html#Advance">Advance</a></li><li data-type='method'><a href="AxisSetTraverser.html#CreateIterationParams">CreateIterationParams</a></li><li data-type='method'><a href="AxisSetTraverser.html#ExamineAxisNames">ExamineAxisNames</a></li><li data-type='method'><a href="AxisSetTraverser.html#LookupIterationDescriptor">LookupIterationDescriptor</a></li><li data-type='method'><a href="AxisSetTraverser.html#WriteReport">WriteReport</a></li></ul></li><li><a href="DataSet.html">DataSet</a></li><li><a href="DataSetFetcher.html">DataSetFetcher</a><ul class='methods'><li data-type='method'><a href="DataSetFetcher.html#Fetch">Fetch</a></li></ul></li><li><a href="EpochStats.html">EpochStats</a><ul class='methods'><li data-type='method'><a href="EpochStats.html#.WriteReportHeader">WriteReportHeader</a></li><li data-type='method'><a href="EpochStats.html#Update">Update</a></li><li data-type='method'><a href="EpochStats.html#WriteReport">WriteReport</a></li></ul></li><li><a href="ExponentialProgression.html">ExponentialProgression</a><ul class='methods'><li data-type='method'><a href="ExponentialProgression.html#Advance">Advance</a></li><li data-type='method'><a href="ExponentialProgression.html#Reset">Reset</a></li></ul></li><li><a href="FailureMessage.html">FailureMessage</a></li><li><a href="FibonacciProgression.html">FibonacciProgression</a><ul class='methods'><li data-type='method'><a href="FibonacciProgression.html#Advance">Advance</a></li><li data-type='method'><a href="FibonacciProgression.html#Reset">Reset</a></li></ul></li><li><a href="FileIOResult.html">FileIOResult</a></li><li><a href="Grid.html">Grid</a><ul class='methods'><li data-type='method'><a href="Grid.html#Run">Run</a></li></ul></li><li><a href="GridOptions.html">GridOptions</a><ul class='methods'><li data-type='method'><a href="GridOptions.html#GetOption">GetOption</a></li></ul></li><li><a href="GridRunStats.html">GridRunStats</a><ul class='methods'><li data-type='method'><a href="GridRunStats.html#AddIterationResult">AddIterationResult</a></li><li data-type='method'><a href="GridRunStats.html#WriteCSV">WriteCSV</a></li><li data-type='method'><a href="GridRunStats.html#WriteReport">WriteReport</a></li></ul></li><li><a href="IterationResult.html">IterationResult</a><ul class='methods'><li data-type='method'><a href="IterationResult.html#WriteEpochStatsHeader">WriteEpochStatsHeader</a></li><li data-type='method'><a href="IterationResult.html#WriteEpochStatsValues">WriteEpochStatsValues</a></li><li data-type='method'><a href="IterationResult.html#WriteModelParamHeader">WriteModelParamHeader</a></li><li data-type='method'><a href="IterationResult.html#WriteModelParamValues">WriteModelParamValues</a></li><li data-type='method'><a href="IterationResult.html#WriteReport">WriteReport</a></li><li data-type='method'><a href="IterationResult.html#WriteTestStatsHeader">WriteTestStatsHeader</a></li><li data-type='method'><a href="IterationResult.html#WriteTestStatsValues">WriteTestStatsValues</a></li></ul></li><li><a href="LinearProgression.html">LinearProgression</a><ul class='methods'><li data-type='method'><a href="LinearProgression.html#Advance">Advance</a></li><li data-type='method'><a href="LinearProgression.html#Reset">Reset</a></li></ul></li><li><a href="ModelParams.html">ModelParams</a><ul class='methods'><li data-type='method'><a href="ModelParams.html#GetBooleanParam">GetBooleanParam</a></li><li data-type='method'><a href="ModelParams.html#GetNumericParam">GetNumericParam</a></li><li data-type='method'><a href="ModelParams.html#GetTextParam">GetTextParam</a></li></ul></li><li><a href="ModelStatics.html">ModelStatics</a><ul class='methods'><li data-type='method'><a href="ModelStatics.html#AttemptStripParam">AttemptStripParam</a></li><li data-type='method'><a href="ModelStatics.html#GenerateInitializerBias">GenerateInitializerBias</a></li><li data-type='method'><a href="ModelStatics.html#GenerateInitializerKernel">GenerateInitializerKernel</a></li><li data-type='method'><a href="ModelStatics.html#GenerateLossFunction">GenerateLossFunction</a></li><li data-type='method'><a href="ModelStatics.html#GenerateOptimizer">GenerateOptimizer</a></li><li data-type='method'><a href="ModelStatics.html#ShallowCloneParams">ShallowCloneParams</a></li></ul></li><li><a href="ModelTestStats.html">ModelTestStats</a><ul class='methods'><li data-type='method'><a href="ModelTestStats.html#CalculateScore">CalculateScore</a></li></ul></li><li><a href="PredictionEvaluation.html">PredictionEvaluation</a></li><li><a href="Progression.html">Progression</a><ul class='methods'><li data-type='method'><a href="Progression.html#Reset">Reset</a></li></ul></li><li><a href="SessionData.html">SessionData</a><ul class='methods'><li data-type='method'><a href="SessionData.html#.CountLeafElements">CountLeafElements</a></li><li data-type='method'><a href="SessionData.html#.FindMean">FindMean</a></li><li data-type='method'><a href="SessionData.html#.FindStandardDeviation">FindStandardDeviation</a></li><li data-type='method'><a href="SessionData.html#.StandardizeInputs">StandardizeInputs</a></li></ul></li></ul><h3>Modules</h3><ul><li><a href="module-FileIO.html">FileIO</a><ul class='methods'><li data-type='method'><a href="module-FileIO.html#~ProduceResultsFilename">ProduceResultsFilename</a></li><li data-type='method'><a href="module-FileIO.html#~ReadDataFile">ReadDataFile</a></li><li data-type='method'><a href="module-FileIO.html#~WriteResultsFile">WriteResultsFile</a></li><li data-type='method'><a href="module-FileIO.html#~WriteSystemPath">WriteSystemPath</a></li></ul></li><li><a href="module-main.html">main</a></li><li><a href="module-Utils.html">Utils</a><ul class='methods'><li data-type='method'><a href="module-Utils.html#~ArrayCalculateAverage">ArrayCalculateAverage</a></li><li data-type='method'><a href="module-Utils.html#~ArrayFindIndexOfHighestValue">ArrayFindIndexOfHighestValue</a></li><li data-type='method'><a href="module-Utils.html#~Assert">Assert</a></li><li data-type='method'><a href="module-Utils.html#~CheckFloat0to1Exclusive">CheckFloat0to1Exclusive</a></li><li data-type='method'><a href="module-Utils.html#~CheckNonNegativeInteger">CheckNonNegativeInteger</a></li><li data-type='method'><a href="module-Utils.html#~CheckPositiveInteger">CheckPositiveInteger</a></li><li data-type='method'><a href="module-Utils.html#~QueueRotate">QueueRotate</a></li><li data-type='method'><a href="module-Utils.html#~ThrowCaughtUnknown">ThrowCaughtUnknown</a></li><li data-type='method'><a href="module-Utils.html#~ValidateTextForCSV">ValidateTextForCSV</a></li><li data-type='method'><a href="module-Utils.html#~WriteDurationReport">WriteDurationReport</a></li></ul></li></ul>
</nav>

<div id="main">
    

    



    


    <section class="package">
        <h3> </h3>
    </section>









    



    <section class="readme usertext jm_homepage">
        <article><h1>tfjs-node-grid-search Â· <a href="https://www.npmjs.com/package/tfjs-node-grid-search"><img src="https://img.shields.io/npm/v/tfjs-node-grid-search.svg?style=flat" alt="npm version"></a> <a href="https://github.com/joemullenix-ks/tfjs-node-grid-search/blob/main/LICENSE"><img src="https://img.shields.io/apm/l/atomic-design-ui.svg?" alt="MIT License"></a></h1>
<span style="font-size:0.85em">
<table>
<thead>
<tr>
<th>Statements</th>
<th>Branches</th>
<th>Functions</th>
<th>Lines</th>
</tr>
</thead>
<tbody>
<tr>
<td><img src="https://img.shields.io/badge/Coverage-100%25-brightgreen.svg" alt="Statements"></td>
<td><img src="https://img.shields.io/badge/Coverage-100%25-brightgreen.svg" alt="Branches"></td>
<td><img src="https://img.shields.io/badge/Coverage-100%25-brightgreen.svg" alt="Functions"></td>
<td><img src="https://img.shields.io/badge/Coverage-100%25-brightgreen.svg" alt="Lines"></td>
</tr>
</tbody>
</table>
</span>
<br>
<p><strong>tfjs-node-grid-search (TNGS)</strong> is a grid search utility for TensorFLow.js in
Node.js. Simply define ranges of hyperparameters. For every combination, TNGS
will create a model, train it and test it using your data set. Results are
logged and (optionally) written as a CSV file.</p>
<p><a href="https://www.tensorflow.org/js/tutorials/setup#nodejs_setup">Learn about running TensorFlow in Node.</a></p>
<h2>Installation</h2>
<pre class="prettyprint source"><code>npm i tfjs-node-grid-search
</code></pre>
<h2>Documentation</h2>
<p>https://github.com/joemullenix-ks/tfjs-node-grid-search/wiki</p>
<h2>Full Example</h2>
<pre class="prettyprint source lang-js"><code>import * as tngs from 'tfjs-node-grid-search';

console.log('Welcome to TNGS!');

//NOTE: We wrap the example in an async function, because tfjs's model fit
//      is asynchronous.
const main = async () => {
  // First, we define the axes for our grid search (the available axis types are
  // enumerated in Axis (with many more coming soon!)).
  // For each axis, we set a begin and end boundary, which are inclusive. We
  // also create a progression across that range, i.e. the values at which
  // we'll stop to train and test a model.

  const axes = [];

  // test batch sizes from 8 to 16 inclusive, in linear steps of 4 (8, 12, 16)
  axes.push(
    new tngs.Axis(
      tngs.AxisTypes.BATCH_SIZE,
      8,
      16,
      new tngs.LinearProgression(4)
    )
  );

  // test nuerons-per-hidden-layer from 10 to 18 inclusive, using the beginning
  // of the Fibonacci sequence (10, 11, 12, 13, 15, 18)
  axes.push(
    new tngs.Axis(
      tngs.AxisTypes.NEURONS,
      10,
      18,
      new tngs.FibonacciProgression(0)
    )
  );

  const axisSet = new tngs.AxisSet(axes);

  // Next, we define the static parameters. That is, those params that never
  // change during our grid search.

  const modelStatics = new tngs.ModelStatics({
    epochs: 5,
    hiddenLayers: 1,
    validationSplit: 0.25
  });

  // Next, we setup options that will govern the Grid itself, as well as the
  // search process.

  const gridOptions = new tngs.GridOptions({
    epochStatsDepth: 3,
    repetitions: 2,
    resultsDirectory: '',
    validationSetSizeMin: 1000,
    writeResultsAsCSV: true
  });

  // Now we load and configure the data set. A fresh copy of this data will be
  // used to train and test each 'iteration' of the grid search (i.e. each
  // unique combination of dynamic params).

  const dataSetFetcher = new tngs.DataSetFetcher(process.argv);

  const dataSet = await dataSetFetcher.Fetch();

  // set aside 10% of these cases for post-training generalization tests
  const TEST_DATA_FRACTION = 0.1;

  const sessionData = new tngs.SessionData(
    TEST_DATA_FRACTION,
    dataSet,
    true
  );

  // This callback is used by the Grid during generalization testing. At the end
  // of each epoch (after) the network is trained, the Grid makes predictions
  // using the test data. For each prediction, it calls this function, passing
  // the known targets and its prediction.
  // We evaluate each prediction, and return a PredictionEvaluation, which lets
  // Grid score the network.
  //	- If the prediction is acceptable, set the first argument (&quot;correct&quot;)
  //    to true.
  //	- The second argument (which is optional) is &quot;delta&quot;, or an arbitrary
  //    value for the prediction.

  const evaluatePrediction = (target: number[], prediction: number[]) => {
    const targettedIndex = tngs.Utils.ArrayFindIndexOfHighestValue(target);

    const predictedIndex = tngs.Utils.ArrayFindIndexOfHighestValue(prediction);

//NOTE: This example is written for a multi-class classification network
//      (one-hot targets).

    // if the network chose the correct index, we pass true
    const correct = targettedIndex === predictedIndex;

    // we also pass a delta value, measuring how close the prediciton is to 1.0
    // (or 100% probability)
    const delta = 1 - prediction[predictedIndex];

    return new tngs.PredictionEvaluation(correct, delta);
  };

  // We're now ready to create the Grid, and run the search!

  const grid = new tngs.Grid(
    axisSet,
    modelStatics,
    sessionData,
    evaluatePrediction,
    gridOptions
  );

  await grid.Run();
};

// run the example (with a top-level exception handler)
main().catch(reason => {
  console.log('There was a problem.', reason);
});
</code></pre>
<h2>Step-By-Step</h2>
<h3>1. Include the library</h3>
<p>There are two supported methods for including the TNGS library:</p>
<p>Via ES Modules (import)</p>
<pre class="prettyprint source"><code>import * as tngs from 'tfjs-node-grid-search';
</code></pre>
<p>Via CommonJS (require)</p>
<pre class="prettyprint source"><code>const tngs = require('tfjs-node-grid-search');
</code></pre>
<blockquote>
<p>NOTE: It's important the grid search be done in an async context, because the
filesystem reads and the model training process are asynchronous.</p>
</blockquote>
<h3>2. Define the grid's axes (the dynamic parameters)</h3>
<p>Decide which hyperparameters will have a range of values. For each, create an
<a href="Axis.html">Axis</a>. Use an array of axes to instatiate an <a href="https://joemullenix-ks.github.io/tfjs-node-grid-search/AxisSet.html">AxisSet</a>.
Example:</p>
<pre class="prettyprint source lang-js"><code>  const axes = [];

  // test batch sizes from 8 to 16 inclusive, in linear steps of 4 (8, 12, 16)
  axes.push(
    new tngs.Axis(
      tngs.AxisTypes.BATCH_SIZE,
      8,
      16,
      new tngs.LinearProgression(4)
    )
  );

  // test learning rates from 0.01 to 0.001 inclusive, in linear steps of 0.003
  // (0.01, 0.007, 0.004, 0.001)
  axes.push(
    new tngs.Axis(
      tngs.AxisTypes.LEARN_RATE,
      0.01,
      0.001,
      new tngs.LinearProgression(0.003)
    )
  );

  const axisSet = new tngs.AxisSet(axes);
</code></pre>
<h3>3. Define the static model parameters</h3>
<p>Set values for model parameters that will <em>not</em> change throughout the search.
Instantiate a ModelStatics{{LINK TO DOCS}} with these values.</p>
<pre class="prettyprint source lang-js"><code>  const modelStatics = new tngs.ModelStatics({
    epochs: 5,
    hiddenLayers: 1,
    validationSplit: 0.25
  });
</code></pre>
<h3>4. (OPTIONAL) Define search parameters</h3>
<p>There are optional settings that do not affect your neural network. If you wish
to modify these, instantiate a GridOptions{{LINK TO DOCS}}. Otherwise defaults
will be used.</p>
<pre class="prettyprint source lang-js"><code>  const gridOptions = new tngs.GridOptions({
    epochStatsDepth: 3,
    repetitions: 2,
    resultsDirectory: '',
    validationSetSizeMin: 1000,
    writeResultsAsCSV: true
  });
</code></pre>
<h3>5. Fetch the data set</h3>
<p>Fetch your training/testing data by passing the filepaths to an instance of
DataSetFetcher{{LINK TO DOCS}}, and fetching an instance of DataSet{{LINK TO DOCS}}.</p>
<blockquote>
<p>NOTE: DataSetFetcher is designed to take the Node launch-args vector (see
example), but any array of strings will work. It expects the third item in the
array to be the path to your inputs file, and the fourth to be the path to your
targets file.</p>
</blockquote>
<p>Intantiate a SessionData{{LINK TO DOCS}} with the DataSet and your standardization preferences.</p>
<pre class="prettyprint source"><code>If you use process.argv as designed, consider launching your app like this:

Example command line
  > node my-tngs-app.js data_inputs.txt data_targets.txt

Example VSCode configuration property (in launch.json)
  &quot;args&quot;: [&quot;data_inputs.txt&quot;, &quot;data_targets.txt&quot;]
</code></pre>
<pre class="prettyprint source lang-js"><code>  const dataSetFetcher = new tngs.DataSetFetcher(process.argv);

  const dataSet = await dataSetFetcher.Fetch();

  // set aside 10% of these cases for post-training generalization tests
  const TEST_DATA_FRACTION = 0.1;

  const sessionData = new tngs.SessionData(
    TEST_DATA_FRACTION,
    dataSet,
    true
  );
</code></pre>
<h3>6. Define the evaluation callback</h3>
<p>One callback must be supplied to the search, so that predictions can be scored.
Define a function that takes two arrays (&quot;target&quot; and &quot;prediction&quot;), and
returns an instance of PredictionEvaluation{{LINK TO DOCS}}.
The search process will gather your scores, and create a report telling you how
each combination of hyperparameters performed.</p>
<pre class="prettyprint source lang-js"><code>  const evaluatePrediction = (target: number[], prediction: number[]) => {
    const targettedIndex = tngs.Utils.ArrayFindIndexOfHighestValue(target);

    const predictedIndex = tngs.Utils.ArrayFindIndexOfHighestValue(prediction);

    return new tngs.PredictionEvaluation(targettedIndex === predictedIndex);
  };
</code></pre>
<h3>7. (OPTIONAL) Define reporting callbacks</h3>
<p>By default, the system will report results and test stats to the log at the end
of every epoch. If you wish to do your own analysis, you may provide callbacks
for end-of-batch, end-of-epoch, and end-of-iteration (where 'iteration' is a
single model run).
These optional functions have the following signatures:</p>
<pre class="prettyprint source lang-js"><code>callbackReportIteration(duration: number, predictions: number[][], proofInputs: Array, proofTargets: number[][])

callbackReportEpoch(duration: number, epoch: number, logs: tf.Logs, epochStats: EpochStats)

callbackReportBatch(duration: number, predictions: number[][], proofInputs: Array, proofTargets: number[][])
</code></pre>
<p>Pass them to Grid{{LINK TO DOCS}}. No return value(s) are expected.</p>
<h3>8. Run the grid search</h3>
<p>You're all set! Instantiate a Grid{{LINK TO DOCS}}, and call Run(). Again, this
should be run in an async function, as TensorFlow's model.fit is asynchronous.</p>
<pre class="prettyprint source lang-js"><code>  const grid = new tngs.Grid(
    axisSet,
    modelStatics,
    sessionData,
    evaluatePrediction,
    gridOptions
  );

  await grid.Run();
</code></pre>
<h2>Roadmap</h2>
<ul>
<li>Rewrite DataSetFetcher as a utility, rather than a class to be instantiated.</li>
<li>Support data fetch via URL.</li>
<li>Offer custom schedules (as opposed to progressions) of grid-axis steps.</li>
<li>Optional callback for create-model.</li>
<li>Optional callback for compile-model (and/or more initializers, optimizers,
loss functions and metrics).</li>
<li>Support additional hyperparams (e.g. bias, dropouts).</li>
<li>Detection and intervention/early-exit on overfit/stuck.</li>
<li>Support other network types (e.g. regression) w/ templates.</li>
<li>Support more complex networks (e.g. multi in/out, convolutions).</li>
<li>Write the model &amp; weight files. // UNBLOCKED by the node bug as of 2.8.0!</li>
<li>Smart-start method for skipping poor/unlucky initial weights.</li>
<li>Node FORK/SPAWN for parallel runs.</li>
<li>Localization, as desired (very few external strings).</li>
</ul>
<h2>Windows</h2>
<blockquote>
<p>:warning: An older version of tfjs-node (v2.7.0) has an installation problem
on Windows.<br>
<a href="https://github.com/tensorflow/tfjs/issues/4052">See details</a></p>
<pre><code>    TLDR, here's the workaround:

    Copy tensorflow.dll
        from: node_modules\@tensorflow\tfjs-node\deps\lib
          to: node_modules\@tensorflow\tfjs-node\lib\napi-v6
</code></pre>
</blockquote>
<h2>License</h2>
<p>tfjs-node-grid-search is <a href="./LICENSE">MIT licensed</a>.</p></article>
    </section>







    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.6</a> using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>



</body>
</html>